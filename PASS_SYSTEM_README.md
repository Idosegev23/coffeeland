# ××¢×¨×›×ª ×›×¨×˜×™×¡×™×•×ª ×•× ××× ×•×ª CoffeeLand

## ×¡×§×™×¨×” ×›×œ×œ×™×ª

××¢×¨×›×ª ××§×™×¤×” ×œ× ×™×”×•×œ ×›×¨×˜×™×¡×™×•×ª (××©×—×§×™×™×”, ×¡×“× ××•×ª, ××™×¨×•×¢×™×) ×•×›×¨×˜×™×¡×™×™×ª × ××× ×•×ª ×§×¤×” ×¢× QR code.

## ×ª×›×•× ×•×ª

### ğŸ‘¤ ×œ××©×ª××©×™×
- **×”×¨×©××” ×•×”×ª×—×‘×¨×•×ª** - ×—×©×‘×•×Ÿ ××™×©×™ ×¢× QR ×™×™×—×•×“×™
- **×¨×›×™×©×ª ×›×¨×˜×™×¡×™×•×ª** - ××©×—×§×™×™×” (5/10 ×›× ×™×¡×•×ª), ×¡×“× ××•×ª, ××™×¨×•×¢×™×
- **QR Code ××™×©×™** - ×œ×”×¦×’×” ×‘×¢×ª ×‘×™×§×•×¨ + ××¤×©×¨×•×ª ×”×•×¨×“×”
- **×›×¨×˜×™×¡×™×™×ª × ××× ×•×ª** - 10 ×—×•×ª××•×ª = ×§×¤×” ×—×™× ×
- **××™×–×•×¨ ××™×©×™** - ×¦×¤×™×™×” ×‘×›×¨×˜×™×¡×™×•×ª, ×—×•×ª××•×ª, ×”×™×¡×˜×•×¨×™×”

### ğŸ‘¨â€ğŸ’¼ ×œ××“××™× ×™×
- **×¡×¨×™×§×ª QR** - ××¦×œ××” ××• ×”×–× ×” ×™×“× ×™×ª
- **× ×™×¦×•×œ ×›×¨×˜×™×¡×™×•×ª** - ×”×¤×—×ª×ª ×›× ×™×¡×•×ª ××•×˜×•××˜×™×ª
- **× ×™×”×•×œ × ××× ×•×ª** - ×”×•×¡×¤×ª ×—×•×ª××•×ª + ××™××•×© ×§×¤×”
- **×“×©×‘×•×¨×“** - ×¡×˜×˜×™×¡×˜×™×§×•×ª ×•× ×™×”×•×œ

## ××‘× ×” ×”×˜×‘×œ××•×ª

```
users
â”œâ”€â”€ id (uuid, PK)
â”œâ”€â”€ email (unique)
â”œâ”€â”€ full_name
â”œâ”€â”€ phone
â”œâ”€â”€ qr_code (unique) â† QR ×™×™×—×•×“×™ ×œ××©×ª××©
â””â”€â”€ created_at

admins
â”œâ”€â”€ id (uuid, PK)
â”œâ”€â”€ user_id (FK â†’ users) â† ××“××™× ×™× × ×§×‘×¢×™× ×™×“× ×™×ª
â”œâ”€â”€ is_active
â””â”€â”€ created_at

passes
â”œâ”€â”€ id (uuid, PK)
â”œâ”€â”€ user_id (FK â†’ users)
â”œâ”€â”€ type (playground/workshop/event)
â”œâ”€â”€ total_entries
â”œâ”€â”€ remaining_entries â† ××ª×¢×“×›×Ÿ ×‘×›×œ × ×™×¦×•×œ
â”œâ”€â”€ purchase_date
â”œâ”€â”€ expiry_date
â”œâ”€â”€ status (active/expired/depleted)
â””â”€â”€ price_paid

pass_usages
â”œâ”€â”€ id (uuid, PK)
â”œâ”€â”€ pass_id (FK â†’ passes)
â”œâ”€â”€ used_by_admin (FK â†’ admins)
â”œâ”€â”€ used_at
â””â”€â”€ notes

loyalty_cards
â”œâ”€â”€ id (uuid, PK)
â”œâ”€â”€ user_id (FK â†’ users, unique)
â”œâ”€â”€ total_stamps â† ××•× ×” ×—×•×ª××•×ª × ×•×›×—×™
â”œâ”€â”€ redeemed_coffees â† ×›××” ×§×¤×” ×—×™× × ××•××©×•
â””â”€â”€ created_at

loyalty_stamps
â”œâ”€â”€ id (uuid, PK)
â”œâ”€â”€ loyalty_card_id (FK â†’ loyalty_cards)
â”œâ”€â”€ stamped_by_admin (FK â†’ admins)
â”œâ”€â”€ stamped_at
â””â”€â”€ is_redeemed â† true ××—×¨×™ ××™××•×©
```

## Flow ××©×ª××©

### 1. ×”×¨×©××” ×•×¨×›×™×©×”
```
××©×ª××© â†’ /register
  â†“
××™×œ×•×™ ×˜×•×¤×¡ (×©×, email, ×˜×œ×¤×•×Ÿ, ×¡×™×¡××”)
  â†“
×™×¦×™×¨×ª QR ×™×™×—×•×“×™ + loyalty card ××•×˜×•××˜×™
  â†“
/my-account (××•×˜×•××˜×™)
  â†“
/passes (×¨×›×™×©×ª ×›×¨×˜×™×¡×™×•×ª)
  â†“
×‘×—×™×¨×ª ×›×¨×˜×™×¡×™×™×” â†’ "×¨×›×•×©" (mockup - ×œ×œ× ×ª×©×œ×•× ×××™×ª×™)
  â†“
×—×–×¨×” ×œ-/my-account ×¢× ×›×¨×˜×™×¡×™×™×” ×—×“×©×”
```

### 2. ×©×™××•×© ×‘×›×¨×˜×™×¡×™×™×”
```
××©×ª××© ××’×™×¢ ×œ-CoffeeLand
  â†“
×¤×•×ª×— /my-account â†’ ××¦×™×’ QR
  â†“
×¦×•×•×ª ×¡×•×¨×§ QR ×‘-/admin/scan
  â†“
××•×¦×’ modal ×¢× ×›×¨×˜×™×¡×™×•×ª
  â†“
×œ×—×™×¦×” ×¢×œ "× ×¦×œ ×›× ×™×¡×”"
  â†“
remaining_entries ×™×•×¨×“ ×‘-1
  â†“
× ×¨×©× ×‘-pass_usages
```

### 3. × ××× ×•×ª ×§×¤×”
```
××©×ª××© ×§×•× ×” ×§×¤×”
  â†“
×¦×•×•×ª ×¡×•×¨×§ QR
  â†“
×œ×—×™×¦×” ×¢×œ "×”×•×¡×£ ×—×•×ª××ª"
  â†“
total_stamps ×¢×•×œ×” ×‘-1
  â†“
××—×¨×™ 10 ×—×•×ª××•×ª:
  â†“
××“××™×Ÿ ×œ×•×—×¥ "××™××•×© ×§×¤×” ×—×™× ×"
  â†“
10 ×—×•×ª××•×ª ××¡×•×× ×•×ª is_redeemed=true
  â†“
total_stamps ××ª××¤×¡
  â†“
redeemed_coffees ×¢×•×œ×” ×‘-1
```

## API Endpoints

### Public
- `POST /api/admin/validate-qr` - ××™××•×ª QR ×•×”×—×–×¨×ª × ×ª×•× ×™ ××©×ª××©
- `POST /api/admin/use-pass` - × ×™×¦×•×œ ×›× ×™×¡×” ××›×¨×˜×™×¡×™×™×”
- `POST /api/admin/add-stamp` - ×”×•×¡×¤×ª ×—×•×ª××ª × ××× ×•×ª
- `POST /api/admin/redeem-coffee` - ××™××•×© ×§×¤×” ×—×™× ×

## Pages

### ××©×ª××©×™×
- `/register` - ×”×¨×©××”
- `/login` - ×”×ª×—×‘×¨×•×ª
- `/passes` - ×¨×›×™×©×ª ×›×¨×˜×™×¡×™×•×ª
- `/my-account` - ××™×–×•×¨ ××™×©×™

### ××“××™× ×™×
- `/admin` - ×“×©×‘×•×¨×“
- `/admin/scan` - ×¡×¨×™×§×ª QR

## Components

### Account
- `QRCodeDisplay` - ×”×¦×’×ª QR + ×”×•×¨×“×”
- `PassCard` - ×›×¨×˜×™×¡×™×™×” ×¢× progress bar
- `LoyaltyCard` - 10 ××©×‘×¦×•×ª ×¢× ×—×•×ª××•×ª (×œ×•×’×•)
- `UsageHistory` - ×”×™×¡×˜×•×¨×™×™×ª ×©×™××•×©×™×

### Admin
- `QRScanner` - ×¡×¨×™×§×” ×‘××¦×œ××” ××• ×™×“× ×™×ª (html5-qrcode)
- `UserPassesModal` - ×”×¦×’×ª ×›×¨×˜×™×¡×™×•×ª + ×¤×¢×•×œ×•×ª

## Security

### RLS Policies
- Users ×¨×•××™× ×¨×§ ××ª ×”× ×ª×•× ×™× ×©×œ×”×
- Admins ×¨×•××™× ×”×›×œ (×“×¨×š is_active check)
- Pass usages ××•×’× ×™×

### Middleware
- `/admin/*` - ×¨×§ ××“××™× ×™× ×××•×©×¨×™×
- `/my-account` - ×¨×§ ××©×ª××©×™× ××—×•×‘×¨×™×

## ×”×’×“×¨×ª ××“××™×Ÿ

×œ××—×¨ ×™×¦×™×¨×ª ××©×ª××© ×“×¨×š `/register`, ×”×¤×•×š ××•×ª×• ×œ××“××™×Ÿ:

```sql
-- In Supabase SQL Editor
INSERT INTO public.admins (user_id, is_active)
VALUES ('USER_ID_FROM_AUTH_USERS', true);
```

## Testing Flow

1. **×”×™×¨×©×** ×‘-`/register`
2. **×¨×›×•×© ×›×¨×˜×™×¡×™×™×”** ×‘-`/passes`
3. **×¨××” QR** ×‘-`/my-account`
4. **×¦×•×¨ ××“××™×Ÿ** ×“×¨×š SQL
5. **×”×ª×—×‘×¨ ×›××“××™×Ÿ** ×‘-`/login` â†’ redirect to `/admin`
6. **×¡×¨×•×§ QR** ×‘-`/admin/scan`
7. **× ×¦×œ ×›× ×™×¡×”** ××• **×”×•×¡×£ ×—×•×ª××ª**

## Dependencies

```json
{
  "qrcode.react": "^4.0.1",
  "html5-qrcode": "^2.3.8",
  "nanoid": "^5.0.4",
  "@supabase/supabase-js": "latest",
  "@supabase/auth-helpers-nextjs": "latest"
}
```

## Next Steps

- [ ] ×—×™×‘×•×¨ ×œ××¢×¨×›×ª ×ª×©×œ×•××™× ×××™×ª×™×ª (Stripe/Tranzila)
- [ ] ×©×œ×™×—×ª QR ×‘××™××™×™×œ ××—×¨×™ ×¨×›×™×©×”
- [ ] ×”×ª×¨××•×ª Push ×›×©-10 ×—×•×ª××•×ª ××•×©×œ××•×ª
- [ ] ×™×™×¦×•× ×“×•×—×•×ª ×œ××“××™×Ÿ
- [ ] × ×™×”×•×œ ××©×ª××©×™× (×¢×¨×™×›×”, ×—×¡×™××”)

